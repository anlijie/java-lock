# java-lock
java版本的用Zookeeper实现的分布式锁

代码已经测过，可以直接使用！

#业务场景

在分布式情况，生成全局订单号ID

生成订单号方案

1.	使用时间戳

2.	使用UUID

3.	推特 (Twitter) 的 Snowflake 算法——用于生成唯一 ID

#产生问题

在分布式(集群)环境下，每台JVM不能实现同步，在分布式场景下使用时间戳生成订单号可能会重复

#分布式情况下，怎么解决订单号生成不重复

1.	使用分布式锁

2.	提前生成好，订单号，存放在redis取。获取订单号，直接从redis中取。

#使用分布式锁生成订单号技术

1.使用数据库实现分布式锁

缺点:性能差、线程出现异常时，容易出现死锁

2.使用redis实现分布式锁

缺点:锁的失效时间难控制、容易产生死锁、非阻塞式、不可重入

3.使用zookeeper实现分布式锁

实现相对简单、可靠性强、使用临时节点，失效时间容易控制

什么是分布式锁

分布式锁一般用在分布式系统或者多个应用中，用来控制同一任务是否执行或者任务的执行顺序。在项目中，部署了多个tomcat应用，在执行定时任务时就会遇到同一任

务可能执行多次的情况，我们可以借助分布式锁，保证在同一时间只有一个tomcat应用执行了定时任务

#使用Zookeeper实现分布式锁

#Zookeeper实现分布式锁原理

使用zookeeper创建临时序列节点来实现分布式锁，适用于顺序执行的程序，大体思路就是创建临时序列节点，找出最小的序列节点，获取分布式锁，程序执行完成之后此序列节点消失，通过watch来监控节点的变化，从剩下的节点的找到最小的序列节点，获取分布式锁，执行相应处理，依次类推……

